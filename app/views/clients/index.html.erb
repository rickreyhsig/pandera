<h1 style="font-size: 36px;font-family: verdana, arial, helvetica, sans-serif;"><%= t('clients') %></h1>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="https://jqueryui.com/resources/demos/style.css">

<!--<script src="/assets/jquery.modal.min.js" type="text/javascript" charset="utf-8"></script>
<link rel="stylesheet" href="/assets/jquery.modal.min.css" type="text/css" media="screen" />

    <div id="ex1" style="display:none;">
        <p>Thanks for clicking.  That felt good.  <a href="#" rel="modal:close">Close</a> or press ESC</p>
          </div>

              <p><a href="#ex1" rel="modal:open">Open Modal</a></p>
-->


<!--  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="/resources/demos/style.css">
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
  $( function() {
    $( "#dialog" ).dialog();
  } );
  </script>


<div id="dialog" title="Basic dialog">
  <p>This is the default dialog which is useful for displaying information. The dialog window can be moved, resized and closed with the 'x' icon.</p>
</div> -->

<%= form_tag clients_path, :method => 'get', :id => "clients_search" do %>
  <%= hidden_field_tag :direction, params[:direction] %>
  <%= hidden_field_tag :sort, params[:sort] %>
  <p>
    <%= text_field_tag :search, params[:search], style: "display: initial" %>
    <%= submit_tag "Search", :name => nil, class: "btn btn-default", style: "padding: 3px 2px 1px 2px;" %>
  </p>
<% end %>

<div class="table-responsive">
    <table id="clients_table" class="table table-striped table-bordered table-hover table-condensed table-responsive">
      <thead>
        <tr>
          <th>Name</th>
          <th>Address</th>
          <th>Email</th>
          <th>Phone</th>
          <th>DOB</th>
          <th style="padding-right:20px;">Carrier</th>
          <th colspan="7"></th>
        </tr>
      </thead>

      <tbody>
        <% @clients.each do |client| %>
          <% crt_inv = client.services.where("paid IS NOT TRUE").where("invoice_id IS NULL").length >= 1  %>
          <!--<tr>-->
          <tr <%= 'class=client_tr' if crt_inv %>>
            <td><%= client.name %></td>
            <td><%= client.street_address %></td>
            <td><%= client.email %></td>
            <td><%= client.phone %></td>
            <td><%= client.dob %></td>
            <td><%= Client::CARRIERS.select{ |carrier, email| email == client.sms_gateway }[0][0] if client.sms_gateway %></td>
            <td><%= link_to 'Make Estimate', new_estimate_path(:client_id => client.id) %></td>
            <td><%= link_to 'Charge Service', new_service_path(:client_id => client.id) %></td>
						<td><a class="create-services" id="<%= client.id %>" name="<%= client.name %>">Charge Services</a></td>
            <td <%= 'class=client_td' if crt_inv %>><%= link_to_if(crt_inv,'Create Invoice', new_invoice_path(:client_id => client.id) ) %></td>
            <td><%= link_to 'Details', client %></td>
            <td><%= link_to 'Edit', edit_client_path(client) %></td>
            <td><%= link_to 'Delete', client, method: :delete, data: { confirm: 'Are you sure?' } %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
</div>

<%= link_to 'New Client', new_client_path %> |
<%= link_to 'Create all monthly invoices', create_monthly_invoices_path %>
<br/>
<%= will_paginate @clients %> </br>
<br/>

  <style>
    label, input { display:block; }
    input.text { margin-bottom:12px; width:95%; padding: .4em; }
    fieldset { padding:0; border:0; margin-top:25px; }
    h1 { font-size: 1.2em; margin: .6em 0; }
    div#users-contain { width: 350px; margin: 20px 0; }
    div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
    div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; }
    .ui-dialog .ui-state-error { padding: .3em; }
    .validateTips { border: 1px solid transparent; padding: 0.3em; }
		.ui-dialog-titlebar{ background-color: #68b468;}
  </style>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
  $( function() {
    var dialog, form,

      // From http://www.whatwg.org/specs/web-apps/current-work/multipage/states-of-the-type-attribute.html#e-mail-state-%28type=email%29
      emailRegex = /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,
      name = $( "#name" ),
      allFields = $( [] ).add( name ),
      tips = $( ".validateTips" );

    function updateTips( t ) {
      tips
        .text( t )
        .addClass( "ui-state-highlight" );
      setTimeout(function() {
        tips.removeClass( "ui-state-highlight", 1500 );
      }, 500 );
    }

    function addUser() {
      var valid = true;
      allFields.removeClass( "ui-state-error" );

      alert($('#id').val()+'&'+$('#name').val()+'&'+$('#service_date_1i').val()+'&'+$('#service_date_2i').val()+'&'+$('#service_date_3i').val()+'&'+$('#service_description').val()+'&'+$('#service_price').val()+'&'+$('#service_quantity').val());
		/*$.ajax({
			type: "POST",
			url: url,
			data: data,
			success: success,
			dataType: dataType
		});*/
     if ( valid ) {
        $( "#users tbody" ).append( "<tr>" +
          "<td>" + name.val() + "</td>" +
        "</tr>" );
        dialog.dialog( "close" );
      }
      dialog = $( "#dialog-form" );
      dialog.dialog( "close" );
      return valid;
    }

    dialog = $( "#dialog-form" ).dialog({
      autoOpen: false,
      height: 400,
      width: 350,
      modal: true,
      buttons: {
        "Charge services": addUser,
        Cancel: function() {
          dialog.dialog( "close" );
        }
      },
      close: function() {
        form[ 0 ].reset();
        allFields.removeClass( "ui-state-error" );
      }
    });

    form = dialog.find( "form" ).on( "submit", function( event ) {
      event.preventDefault();
      addUser();
      dialog.dialog( "close" );
    });

    $(".create-services").on( "click", function() {
			var client_id = $(this).attr("id");
			var client_name = $(this).attr("name");
			//alert(client_id);
			$('#id').val(client_id);
			$('#name').val(client_name);
      dialog.dialog( "open" );
    });

  } );
  </script>
</head>
<body>

<div id="dialog-form" title="Add new services">
  <form>
    <fieldset>
      <!--<label for="name">Client ID</label> -->
      <input type="hidden" name="id" id="id" value="" class="text ui-widget-content ui-corner-all">
      <label for="name">Name</label>
      <input type="text" name="name" id="name" value="" disabled class="text ui-widget-content ui-corner-all">

	<span class="field">
      <input value="<%= %>" type="hidden" name="service[client_id]" id="service_client_id">
  </span>
<div class="field">
    <label for="service_date">Date</label>
    <select id="service_date_1i" name="service[date(1i)]">
			<option value="2012">2012</option>
			<option value="2013">2013</option>
			<option value="2014">2014</option>
			<option value="2015">2015</option>
			<option value="2016">2016</option>
			<option value="2017" selected="selected">2017</option>
			<option value="2018">2018</option>
			<option value="2019">2019</option>
			<option value="2020">2020</option>
			<option value="2021">2021</option>
			<option value="2022">2022</option>
		</select>
		<select id="service_date_2i" name="service[date(2i)]">
			<option value="1">January</option>
			<option value="2">February</option>
			<option value="3">March</option>
			<option value="4">April</option>
			<option value="5">May</option>
			<option value="6">June</option>
			<option value="7">July</option>
			<option value="8">August</option>
			<option value="9">September</option>
			<option value="10">October</option>
			<option value="11">November</option>
			<option value="12">December</option>
		</select>
		<select id="service_date_3i" name="service[date(3i)]">
			<option value="1">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5</option>
			<option value="6">6</option>
			<option value="7">7</option>
			<option value="8">8</option>
			<option value="9">9</option>
			<option value="10">10</option>
			<option value="11">11</option>
			<option value="12">12</option>
			<option value="13">13</option>
			<option value="14">14</option>
			<option value="15">15</option>
			<option value="16">16</option>
			<option value="17">17</option>
			<option value="18">18</option>
			<option value="19">19</option>
			<option value="20">20</option>
			<option value="21">21</option>
			<option value="22">22</option>
			<option value="23">23</option>
			<option value="24">24</option>
			<option value="25">25</option>
			<option value="26">26</option>
			<option value="27">27</option>
			<option value="28">28</option>
			<option value="29">29</option>
			<option value="30">30</option>
			<option value="31">31</option>
		</select>
  </div>
	<label for="name">Description</label>
		<select name="service[description]" id="service_description"><option value=""></option>
			<option value="Weekly Cutting">Weekly Cutting</option>
			<option value="Bi-weekly Cutting">Bi-weekly Cutting</option>
			<option value="Mulching">Mulching</option>
			<option value="Gutter Cleaning">Gutter Cleaning</option>
			<option value="Trimming Bushes and Shrubs">Trimming Bushes and Shrubs</option>
			<option value="Fall Clean-Up">Fall Clean-Up</option>
			<option value="Fertilizer">Fertilizer</option>
			<option value="Aeration and Seeding">Aeration and Seeding</option>
			<option value="Power Washing">Power Washing</option>
			<option value="Snow Removal">Snow Removal</option></select>
	</br>
	</br>
 	<span class="field">
    <label for="service_price">Price</label>
    <input type="text" name="service[price]" id="service_price">
  </span>
	<label for="name">Quantity</label>
		<select name="service[quantity]" id="service_quantity"><option value=""></option>
			<option value="1">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
		</select>

      <!-- Allow form submission with keyboard without duplicating the dialog button -->
      <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
    </fieldset>
  </form>
</div>
